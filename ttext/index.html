<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen">
    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <div class="relative h-screen flex">
        <!-- Line numbers -->
        <div id="lineNumbers" class="bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-base font-mono text-right pr-2 pl-2 py-4 select-none overflow-hidden whitespace-pre border-r border-gray-300 dark:border-gray-600" style="min-width: 60px; line-height: 1.5;"></div>
        
        <!-- Text area -->
        <textarea 
            id="textArea"
            class="flex-1 h-full p-4 text-base border-0 resize-none focus:outline-none bg-white dark:bg-gray-900 text-gray-900 dark:text-white font-mono"
            style="line-height: 1.5;"
        ></textarea>
        
        <div id="statusMessage" class="absolute bottom-4 left-16 text-sm text-gray-600 dark:text-gray-400"></div>
    </div>

    <script>
        const textArea = document.getElementById('textArea');
        const lineNumbers = document.getElementById('lineNumbers');
        const statusMessage = document.getElementById('statusMessage');

        async function translateWithAPI(text, lineIndex) {
            try {
                // Using MyMemory free translation API
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|fr`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.responseStatus === 200 || data.responseData) {
                    const translation = data.responseData.translatedText;
                    
                    // Replace the line with the translation
                    const lines = textArea.value.split('\n');
                    lines[lineIndex] = translation;
                    textArea.value = lines.join('\n');
                    
                    // Restore cursor position to the end of the translated line
                    const newCursorPosition = lines.slice(0, lineIndex + 1).join('\n').length;
                    textArea.setSelectionRange(newCursorPosition, newCursorPosition);
                    textArea.focus();
                    
                    statusMessage.textContent = "Line translated successfully!";
                    statusMessage.className = "absolute bottom-4 left-4 text-sm text-green-600 dark:text-green-400";
                    
                    // Clear status after 3 seconds
                    setTimeout(() => {
                        statusMessage.textContent = "";
                    }, 3000);
                } else {
                    throw new Error('Translation service returned an error');
                }
            } catch (error) {
                statusMessage.textContent = "Translation failed: " + error.message;
                statusMessage.className = "absolute bottom-4 left-4 text-sm text-red-600 dark:text-red-400";
            }
        }

        function getCurrentLineInfo() {
            const cursorPosition = textArea.selectionStart;
            const textBeforeCursor = textArea.value.substring(0, cursorPosition);
            const lines = textArea.value.split('\n');
            const lineIndex = textBeforeCursor.split('\n').length - 1;
            const currentLine = lines[lineIndex];
            
            return { lineIndex, currentLine };
        }

        async function translateCurrentLine() {
            const { lineIndex, currentLine } = getCurrentLineInfo();
            
            if (!currentLine.trim()) {
                statusMessage.textContent = "Current line is empty.";
                statusMessage.className = "absolute bottom-4 left-4 text-sm text-yellow-600 dark:text-yellow-400";
                return;
            }
            
            statusMessage.textContent = "";
            
            await translateWithAPI(currentLine, lineIndex);
        }

        // Add keyboard event listener
        textArea.addEventListener('keydown', (event) => {
            // Check for Ctrl+S (or Cmd+S on Mac)
            if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                event.preventDefault(); // Prevent browser save dialog
                translateCurrentLine();
            }
        });

        // Update line numbers
        function updateLineNumbers() {
            const lines = textArea.value.split('\n');
            const lineCount = lines.length;
            
            let numbersHTML = '';
            for (let i = 1; i <= lineCount; i++) {
                numbersHTML += i + '\n';
            }
            lineNumbers.textContent = numbersHTML;
        }

        // Sync scroll between textarea and line numbers
        function syncScroll() {
            lineNumbers.scrollTop = textArea.scrollTop;
        }

        // Event listeners
        textArea.addEventListener('input', updateLineNumbers);
        textArea.addEventListener('scroll', syncScroll);
        
        // Initialize line numbers
        updateLineNumbers();
        
        // Focus the textarea on page load
        textArea.focus();
    </script>
</body>
</html>
